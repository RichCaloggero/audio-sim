<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Test</title>
</head>
<body> 
<label>file: <input type="file" id="load"></label>
<br><label>source: <input type="text" id="media" value="http://archive.org:80/download/gd1973-10-25.136695.sbd.sirmick.flac16/gd1973-10-25s103.mp3"></label>
<audio crossorigin="anonymous" controls></audio>

<br><label>x: <input id="x" type="number" value="0" min="-1" max="1" step=".01"></label>
<br><label>y: <input id="y" type="number" value="0" min="-1" max="1" step=".01"></label>
<br><label>z: <input id="z" type="number" value="0" min="-1" max="1" step=".01"></label>
<br><label>r: <input id="r" type="number" value="0" min="0.01" max="1" step="0.01"></label>
<br><label>a: <input id="a" type="number" value="0" min="0.0" max="6.28" step="0.01"></label>

<script src="loadAudio.js"></script>
<script type="module">
document.querySelector("input").addEventListener("change", run);

async function run (e) {
const c = new AudioContext();
const sources = await loadAudioFiles(e.target.files, c);
console.log("file loaded.");

const s = new AudioBufferSourceNode(c, {buffer: sources[0]});
console.log("buffer created.");

//const media = document.querySelector("audio");
//const s = c.createMediaElementSource(media);

const p = c.createPanner();
const m = c.createChannelMerger(2);
p.channelCount = 1;

s.connect(m).connect(p).connect(c.destination);
p.refDistance =1;
p.rolloffFactor = 1;
p.coneInnerAngle = 180;
p.coneOuterAngle = 360;
p.maxDistance = 10;
p.orientationX.value = 0;
p.panningModel = "HRTF";

let a = 0;
setInterval(() => {
p.positionX.value = Math.cos(a);
p.positionZ.value = Math.sin(a);
a += 0.07;
}, 80);
s.start();

document.querySelector("#media").addEventListener("change", e => media.src = e.target.value);
} // run
</script>

</body>
</html>
